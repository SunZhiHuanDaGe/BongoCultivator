# Plan 4: 修炼数值平衡调整 (Cultivation Balance)

## 目标
调整游戏整体节奏，使其成为更长线的放置养成游戏。
- **炼气期**: 约 1 天
- **筑基期**: 约 1 周 (7天)
- **金丹期**: 约 1 个月 (30天)
- **后续境界**: 每个境界约 1 个月

## 1. 基准数值假设
为了计算各等级所需的具体修为值，我们需要定义“标准玩家”的每日修为获取量。

**假设：**
- 玩家每日运行程序 24 小时 (作为桌面宠物)。
- 其中 **8小时** 为活跃状态 (工作/浏览)，平均 APM 较高 (历练/悟道)。
- 其中 **16小时** 为挂机状态 (Idle/Sleep)。

**每日标准收益计算：**
- **活跃收益**: 8小时 * 3600秒 * 5 (平均活跃exp/s) = 144,000
- **挂机收益**: 16小时 * 3600秒 * 1 (基础Idle exp/s) = 57,600
- **总计**: **约 200,000 修为 / 天**

*注：周末或肝帝玩家可能更高，纯挂机玩家可能更低 (8.6w/天)。我们以 20w 作为平衡基准。*

## 2. 境界修为表设计

**调整规则**: 金丹之后，难度逐步提升 (系数 1.5)。

| 层级 | 境界名称 | 持续时间 (估算) | 所需总修为 (当前等级) | 累计游戏时间 (T+) |
| :--- | :--- | :--- | :--- | :--- |
| 0 | 炼气期 | 1 天 | **200,000** | 1 天 |
| 1 | 筑基期 | 7 天 | **1,400,000** | 8 天 |
| 2 | 金丹期 | 30 天 | **6,000,000** | 38 天 |
| 3 | 元婴期 | 30 天 | **6,000,000** | 68 天 |
| 4 | 化神期 | 45 天 | **9,000,000** | 113 天 |
| 5 | 炼虚期 | 67.5 天 | **13,500,000** | 180.5 天 |
| 6 | 合体期 | 101 天 | **20,250,000** | 281.5 天 |
| 7 | 大乘期 | 152 天 | **30,375,000** | 433.5 天 |
| 8 | 渡劫期 | - | Max | - |

## 3. 代码修改计划 (`src/cultivator.py`)

### 3.1 修改 `max_exp` 属性
废弃旧的 `100 * (2 ** index)` 指数公式，改为基于查找表的逻辑。

```python
# 伪代码示例
EXP_TABLE = [
    200000,      # 0: 炼气
    1400000,     # 1: 筑基
    6000000,     # 2: 金丹
    6000000,     # 3: 元婴
    9000000,     # 4: 化神 (600w * 1.5)
    13500000,    # 5: 炼虚 (900w * 1.5)
    20250000,    # 6: 合体 (1350w * 1.5)
    30375000,    # 7: 大乘 (2025w * 1.5)
    999999999    # 8: 渡劫 (Max)
]

@property
def max_exp(self):
    if self.layer_index < len(EXP_TABLE):
        return EXP_TABLE[self.layer_index]
    return EXP_TABLE[-1]
```

### 3.2 辅助道具调整 (可选)
由于数值膨胀，物品给予的固定修为 (如丹药) 也需要相应调整，或者改为百分比增加。
- 建议：将修为丹药改为 **增加当前等级 1% - 5% 的修为**，而不是固定数值。

---
**Status**: Completed

## 完成情况 (Completion Log)
*Date: 2025-12-24*

### 1. 数值基准落地
- 经确认 `EXP_TABLE` (src/cultivator.py) 已符合炼气(1天) -> 大乘(152天)的规划。
- 基础收益速率维持不变 (Active 5/s, Idle 1/s)，确保每日约 20w 修为的获取基准。
- 修正了 `calculate_offline_progress` 的倍率 (2.5 -> 1.0) 以匹配挂机基准。

### 2. 物品数值平衡
- 更新了 `tools_generate_items.py` 算法：
    - 丹药经验值 = 当前境界总修为上限的 1%。
    - 区分了普通灵草(0.1%)、元果(0.5%)、丹药(1%) 的收益阶梯。
- 重生成并导入了 `items_v2.json` 到数据库 (71种物品)。
- 验证了各阶丹药的经验收益符合预期 (Tier 0: ~2000, Tier 2: ~60000)。

